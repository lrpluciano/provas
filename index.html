<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provas Online</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css">
    <script src="https://unpkg.com/docx@7.8.2/build/index.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/contrib/auto-render.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem 5%;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-container {
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: 85%;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: #f0f0f0;
        }

        .logo h1 {
            font-size: 2.2rem;
            font-weight: 700;
            letter-spacing: -0.5px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Seção de explicação */
        .explanation-section {
            background: #f8f9fa;
            padding: 2rem 5%;
            border-bottom: 1px solid #e0e0e0;
        }

        .explanation-container {
            max-width: 85%;
            margin: 0 auto;
            text-align: center;
        }

        .explanation-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .explanation-title i {
            color: #667eea;
        }

        .explanation-text {
            color: #555;
            line-height: 1.6;
            max-width: 85%;
            margin: 0 auto;
        }

        .features-list {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .feature-item {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #667eea;
            font-weight: 500;
        }

        .main-container {
            max-width: 85%;
            margin: 2rem auto;
            padding: 0 1rem;
        }

        .form-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 2rem;
            border: 1px solid #e0e0e0;
            margin-bottom: 1.5rem;
        }

        .questions-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
            border: 1px solid #e0e0e0;
            margin-bottom: 1.5rem;
        }

        .export-section {
            background: white;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.08);
            padding: 1.5rem;
            border: 1px solid #e0e0e0;
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            color: #333;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-bottom: 0.8rem;
            border-bottom: 2px solid #f0f0f0;
        }

        .section-title i {
            color: #667eea;
        }

        .form-group {
            margin-bottom: 1.2rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #555;
        }

        .form-control {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        /* Editor de Texto Rico */
        .editor-container {
            border: 1px solid #ddd;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 1rem;
        }

        .editor-toolbar {
            background: #f8f9fa;
            padding: 0.8rem;
            border-bottom: 1px solid #ddd;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .toolbar-btn {
            background: transparent;
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #555;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .toolbar-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .toolbar-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .toolbar-divider {
            width: 1px;
            background: #ddd;
            margin: 0 0.3rem;
        }

        .editor-content {
            min-height: 300px;
            padding: 1rem;
            border: none;
            outline: none;
            font-size: 1rem;
            line-height: 1.6;
            overflow-y: auto;
            max-height: 500px;
        }

        .editor-content:focus {
            background: #fafafa;
        }

        .editor-content img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin: 0.5rem 0;
        }

        .editor-content .equation {
            margin: 0.5rem 0;
            padding: 0.5rem;
            background: #f0f0f0;
            border-radius: 4px;
            display: inline-block;
        }

        .editor-label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            color: #555;
            margin-bottom: 0.5rem;
        }

        .editor-label i {
            color: #667eea;
        }

        .alternatives-container {
            margin-top: 1rem;
        }

        .alternative-item {
            display: flex;
            align-items: center;
            margin-bottom: 0.8rem;
            gap: 0.5rem;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alternative-letter {
            width: 36px;
            height: 36px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            flex-shrink: 0;
        }

        .alternative-input {
            flex-grow: 1;
        }

        .btn {
            padding: 0.7rem 1.5rem;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            font-size: 0.95rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5a67d8;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #48bb78;
            color: white;
        }

        .btn-success:hover {
            background: #38a169;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }

        .btn-danger {
            background: #f56565;
            color: white;
        }

        .btn-danger:hover {
            background: #e53e3e;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.85rem;
        }

        .btn-add {
            background: #edf2f7;
            color: #4a5568;
            border: 1px dashed #cbd5e0;
            margin-top: 0.5rem;
            width: 100%;
            justify-content: center;
        }

        .btn-add:hover {
            background: #e2e8f0;
            border-color: #a0aec0;
        }

        .btn-remove {
            background: #fed7d7;
            color: #c53030;
            border: 1px solid #feb2b2;
        }

        .btn-remove:hover {
            background: #fbb6ce;
            border-color: #f687b3;
        }

        .question-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #667eea;
            animation: slideIn 0.3s ease-in-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .question-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.8rem;
        }

        .question-number {
            font-weight: bold;
            color: #667eea;
            font-size: 1.1rem;
        }

        .question-text {
            margin-bottom: 0.8rem;
            line-height: 1.5;
        }

        .question-text img {
            max-width: 100%;
            height: auto;
            border-radius: 4px;
            margin: 0.5rem 0;
        }

        .question-content {
            margin-bottom: 1rem;
        }

        .text-section {
            background: #f0f4f8;
            border-radius: 6px;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            border-left: 3px solid #4299e1;
        }

        .text-section-title {
            font-weight: 600;
            color: #2b6cb0;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .question-section {
            background: #fef5e7;
            border-radius: 6px;
            padding: 0.8rem;
            margin-bottom: 0.8rem;
            border-left: 3px solid #ed8936;
        }

        .question-section-title {
            font-weight: 600;
            color: #c05621;
            margin-bottom: 0.5rem;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .alternatives-list {
            list-style: none;
        }

        .alternatives-list li {
            margin-bottom: 0.4rem;
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .alternatives-list li strong {
            color: #667eea;
            min-width: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 2rem;
            color: #a0aec0;
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 1rem;
            display: block;
        }

        .export-info {
            margin-bottom: 1.5rem;
            color: #555;
        }

        .export-info i {
            color: #667eea;
            margin-right: 0.5rem;
        }

        .loading {
            display: none;
            margin-left: 10px;
        }

        .error-message {
            color: #e53e3e;
            margin-top: 10px;
            display: none;
        }

        .alternative-controls {
            display: flex;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }

        .alternative-info {
            font-size: 0.85rem;
            color: #718096;
            margin-top: 0.5rem;
            font-style: italic;
        }

        /* Modal para inserir equação */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 2rem;
            border-radius: 12px;
            width: 80%;
            max-width: 600px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .modal-title {
            font-size: 1.5rem;
            color: #333;
        }

        .close {
            color: #aaa;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: #000;
        }

        .equation-preview {
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .equation-help {
            font-size: 0.85rem;
            color: #666;
            margin-top: 0.5rem;
        }

        .optional-badge {
            background: #e2e8f0;
            color: #4a5568;
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        .required-badge {
            background: #fed7d7;
            color: #c53030;
            font-size: 0.75rem;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            margin-left: 0.5rem;
        }

        @media (max-width: 768px) {
            .logo h1 {
                font-size: 1.8rem;
            }
            
            .logo i {
                font-size: 2rem;
            }

            .editor-toolbar {
                padding: 0.5rem;
            }

            .toolbar-btn {
                width: 32px;
                height: 32px;
            }

            .features-list {
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }

            .editor-content {
                min-height: 250px;
                max-height: 400px;
            }

            .main-container {
                max-width: 95%;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-container">
            <div class="logo">
                <i class="fas fa-graduation-cap"></i>
                <h1>Provas Online</h1>
            </div>
        </div>
    </header>

    <!-- Seção de explicação -->
    <section class="explanation-section">
        <div class="explanation-container">
            <h2 class="explanation-title">
                <i class="fas fa-info-circle"></i>
                Como Funciona
            </h2>
            <p class="explanation-text">
                O Provas Online é uma ferramenta simples e eficiente para professores criarem provas personalizadas. 
                Você pode adicionar questões com texto contextual, perguntas específicas e múltiplas alternativas, 
                além de inserir imagens e equações matemáticas. Ao final, exporte tudo em um arquivo .docx 
                formatado com as especificações padrão.
            </p>
            <div class="features-list">
                <div class="feature-item">
                    <i class="fas fa-edit"></i>
                    <span>Editor de texto rico</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-image"></i>
                    <span>Inserir imagens</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-square-root-alt"></i>
                    <span>Equações matemáticas</span>
                </div>
                <div class="feature-item">
                    <i class="fas fa-file-download"></i>
                    <span>Exportar para .docx</span>
                </div>
            </div>
        </div>
    </section>

    <div class="main-container">
        <!-- Formulário -->
        <section class="form-section">
            <h2 class="section-title">
                <i class="fas fa-plus-circle"></i>
                Adicionar Questão
            </h2>
            
            <form id="questionForm">
                <!-- 1. Texto (Contexto) -->
                <div class="form-group">
                    <div class="editor-label">
                        <i class="fas fa-align-left"></i>
                        Texto (Contexto)
                        <span class="optional-badge">Opcional</span>
                    </div>
                    <div class="editor-container">
                        <div class="editor-toolbar">
                            <button type="button" class="toolbar-btn" title="Negrito" onclick="formatText('bold', 'textEditor')">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="toolbar-btn" title="Itálico" onclick="formatText('italic', 'textEditor')">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="toolbar-btn" title="Sublinhado" onclick="formatText('underline', 'textEditor')">
                                <i class="fas fa-underline"></i>
                            </button>
                            <div class="toolbar-divider"></div>
                            <button type="button" class="toolbar-btn" title="Inserir imagem" onclick="insertImage('textEditor')">
                                <i class="fas fa-image"></i>
                            </button>
                            <button type="button" class="toolbar-btn" title="Inserir equação" onclick="openEquationModal('textEditor')">
                                <i class="fas fa-square-root-alt"></i>
                            </button>
                        </div>
                        <div class="editor-content" contenteditable="true" id="textEditor" placeholder="Digite o texto de contexto (opcional)..."></div>
                    </div>
                </div>
                
                <!-- 2. Número da Questão -->
                <div class="form-group">
                    <label for="questionNumber">
                        Número da Questão
                        <span class="required-badge">Obrigatório</span>
                    </label>
                    <input type="number" id="questionNumber" class="form-control" min="1" required>
                </div>
                
                <!-- 3. Questão (Pergunta) -->
                <div class="form-group">
                    <div class="editor-label">
                        <i class="fas fa-question-circle"></i>
                        Questão (Pergunta)
                        <span class="required-badge">Obrigatório</span>
                    </div>
                    <div class="editor-container">
                        <div class="editor-toolbar">
                            <button type="button" class="toolbar-btn" title="Negrito" onclick="formatText('bold', 'questionEditor')">
                                <i class="fas fa-bold"></i>
                            </button>
                            <button type="button" class="toolbar-btn" title="Itálico" onclick="formatText('italic', 'questionEditor')">
                                <i class="fas fa-italic"></i>
                            </button>
                            <button type="button" class="toolbar-btn" title="Sublinhado" onclick="formatText('underline', 'questionEditor')">
                                <i class="fas fa-underline"></i>
                            </button>
                            <div class="toolbar-divider"></div>
                            <button type="button" class="toolbar-btn" title="Inserir imagem" onclick="insertImage('questionEditor')">
                                <i class="fas fa-image"></i>
                            </button>
                            <button type="button" class="toolbar-btn" title="Inserir equação" onclick="openEquationModal('questionEditor')">
                                <i class="fas fa-square-root-alt"></i>
                            </button>
                        </div>
                        <div class="editor-content" contenteditable="true" id="questionEditor" placeholder="Digite a pergunta da questão..."></div>
                    </div>
                </div>
                
                <!-- 4. Alternativas -->
                <div class="form-group">
                    <div class="editor-label">
                        <i class="fas fa-list"></i>
                        Alternativas
                        <span class="optional-badge">Opcional</span>
                    </div>
                    <div class="alternatives-container" id="alternativesContainer">
                        <div class="alternative-item">
                            <div class="alternative-letter">A</div>
                            <input type="text" class="form-control alternative-input" placeholder="Alternativa A">
                            <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="alternative-item">
                            <div class="alternative-letter">B</div>
                            <input type="text" class="form-control alternative-input" placeholder="Alternativa B">
                            <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="alternative-item">
                            <div class="alternative-letter">C</div>
                            <input type="text" class="form-control alternative-input" placeholder="Alternativa C">
                            <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="alternative-item">
                            <div class="alternative-letter">D</div>
                            <input type="text" class="form-control alternative-input" placeholder="Alternativa D">
                            <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="alternative-item">
                            <div class="alternative-letter">E</div>
                            <input type="text" class="form-control alternative-input" placeholder="Alternativa E">
                            <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="alternative-controls">
                        <button type="button" class="btn btn-add" id="addAlternativeBtn">
                            <i class="fas fa-plus"></i> Adicionar Alternativa
                        </button>
                    </div>
                    
                    <div class="alternative-info">
                        <i class="fas fa-info-circle"></i> Adicione alternativas se necessário para questões de múltipla escolha
                    </div>
                </div>
                
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-plus"></i> Adicionar Questão
                </button>
            </form>
        </section>

        <!-- Questões Adicionadas -->
        <section class="questions-section">
            <h2 class="section-title">
                <i class="fas fa-list"></i>
                Questões Adicionadas
            </h2>
            
            <div id="questionsList">
                <div class="empty-state">
                    <i class="fas fa-clipboard-list"></i>
                    <p>Nenhuma questão adicionada ainda</p>
                </div>
            </div>
        </section>

        <!-- Exportar Prova -->
        <section class="export-section">
            <h2 class="section-title">
                <i class="fas fa-file-download"></i>
                Exportar Prova
            </h2>
            
            <div class="export-info">
                <p><i class="fas fa-info-circle"></i> A prova será exportada em formato .docx com as seguintes especificações:</p>
                <p>Fonte: Arial 11 | Margens: Superior 3cm, Direita 2cm, Esquerda 3cm, Inferior 2cm</p>
            </div>
            
            <button type="button" class="btn btn-success" id="exportBtn">
                <i class="fas fa-download"></i> Baixar Prova (.docx)
                <i class="fas fa-spinner fa-spin loading" id="loadingIcon"></i>
            </button>
            
            <div class="error-message" id="errorMessage">
                <i class="fas fa-exclamation-triangle"></i> Ocorreu um erro ao gerar o arquivo. Tente novamente.
            </div>
        </section>
    </div>

    <!-- Modal para inserir equação -->
    <div id="equationModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Inserir Equação</h3>
                <span class="close" onclick="closeEquationModal()">&times;</span>
            </div>
            <div class="form-group">
                <label for="equationInput">Digite a equação (LaTeX):</label>
                <input type="text" id="equationInput" class="form-control" placeholder="Ex: \frac{a}{b} + c = d" oninput="updateEquationPreview()">
            </div>
            <div class="equation-preview" id="equationPreview">
                <span style="color: #999;">Pré-visualização da equação</span>
            </div>
            <div class="equation-help">
                <i class="fas fa-info-circle"></i> Use sintaxe LaTeX para equações matemáticas. 
                <a href="https://katex.org/docs/supported.html" target="_blank">Ver exemplos</a>
            </div>
            <div style="margin-top: 1.5rem; display: flex; gap: 1rem; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" onclick="closeEquationModal()">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="insertEquation()">Inserir Equação</button>
            </div>
        </div>
    </div>

    <script>
        // Array para armazenar as questões
        let questions = [];
        let alternativeCount = 5; // Começa com 5 alternativas (A-E)
        let currentEditor = null; // Para saber qual editor está ativo

        // Elementos do DOM
        const questionForm = document.getElementById('questionForm');
        const alternativesContainer = document.getElementById('alternativesContainer');
        const addAlternativeBtn = document.getElementById('addAlternativeBtn');
        const questionsList = document.getElementById('questionsList');
        const exportBtn = document.getElementById('exportBtn');
        const loadingIcon = document.getElementById('loadingIcon');
        const errorMessage = document.getElementById('errorMessage');
        const textEditor = document.getElementById('textEditor');
        const questionEditor = document.getElementById('questionEditor');

        // Placeholder para os editores
        function setupEditor(editor, placeholder) {
            editor.addEventListener('focus', function() {
                if (this.textContent.trim() === '' || this.innerHTML.includes(placeholder)) {
                    this.innerHTML = '';
                }
            });

            editor.addEventListener('blur', function() {
                if (this.textContent.trim() === '') {
                    this.innerHTML = `<span style="color: #999;">${placeholder}</span>`;
                }
            });

            // Inicializar placeholder
            editor.innerHTML = `<span style="color: #999;">${placeholder}</span>`;
        }

        setupEditor(textEditor, 'Digite o texto de contexto (opcional)...');
        setupEditor(questionEditor, 'Digite a pergunta da questão...');

        // Funções do editor de texto
        function formatText(command, editorId) {
            const editor = document.getElementById(editorId);
            editor.focus();
            document.execCommand(command, false, null);
        }

        function insertImage(editorId) {
            const url = prompt('Digite a URL da imagem:');
            if (url) {
                const editor = document.getElementById(editorId);
                editor.focus();
                document.execCommand('insertImage', false, url);
            }
        }

        function openEquationModal(editorId) {
            currentEditor = editorId;
            document.getElementById('equationModal').style.display = 'block';
            document.getElementById('equationInput').value = '';
            document.getElementById('equationPreview').innerHTML = '<span style="color: #999;">Pré-visualização da equação</span>';
        }

        function closeEquationModal() {
            document.getElementById('equationModal').style.display = 'none';
            currentEditor = null;
        }

        function updateEquationPreview() {
            const input = document.getElementById('equationInput').value;
            const preview = document.getElementById('equationPreview');
            
            if (input.trim() === '') {
                preview.innerHTML = '<span style="color: #999;">Pré-visualização da equação</span>';
                return;
            }
            
            try {
                katex.render(input, preview, {
                    throwOnError: false,
                    displayMode: true
                });
            } catch (e) {
                preview.innerHTML = '<span style="color: #e53e3e;">Erro na equação</span>';
            }
        }

        function insertEquation() {
            const input = document.getElementById('equationInput').value;
            if (input.trim() === '') {
                alert('Digite uma equação válida.');
                return;
            }
            
            if (!currentEditor) {
                alert('Selecione um editor para inserir a equação.');
                return;
            }
            
            try {
                const equationHtml = katex.renderToString(input, {
                    throwOnError: false,
                    displayMode: true
                });
                
                const equationElement = document.createElement('div');
                equationElement.className = 'equation';
                equationElement.innerHTML = equationHtml;
                
                // Inserir no editor
                const editor = document.getElementById(currentEditor);
                const selection = window.getSelection();
                if (selection.rangeCount > 0) {
                    const range = selection.getRangeAt(0);
                    range.deleteContents();
                    range.insertNode(equationElement);
                    
                    // Mover cursor após a equação
                    range.setStartAfter(equationElement);
                    range.collapse(true);
                    selection.removeAllRanges();
                    selection.addRange(range);
                } else {
                    editor.appendChild(equationElement);
                }
                
                closeEquationModal();
                editor.focus();
            } catch (e) {
                alert('Erro ao renderizar equação. Verifique a sintaxe LaTeX.');
            }
        }

        // Adicionar nova alternativa
        addAlternativeBtn.addEventListener('click', function() {
            alternativeCount++;
            const letter = String.fromCharCode(64 + alternativeCount); // Converte número para letra (A, B, C...)
            
            const alternativeItem = document.createElement('div');
            alternativeItem.className = 'alternative-item';
            alternativeItem.innerHTML = `
                <div class="alternative-letter">${letter}</div>
                <input type="text" class="form-control alternative-input" placeholder="Alternativa ${letter}">
                <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            alternativesContainer.appendChild(alternativeItem);
            
            // Focar no novo campo
            alternativeItem.querySelector('.alternative-input').focus();
        });

        // Remover alternativa
        function removeAlternative(button) {
            const alternatives = alternativesContainer.querySelectorAll('.alternative-item');
            
            // Não permitir remover se houver menos de 2 alternativas
            if (alternatives.length <= 2) {
                alert('É necessário manter pelo menos 2 alternativas.');
                return;
            }
            
            // Adicionar animação de saída
            const item = button.closest('.alternative-item');
            item.style.animation = 'fadeIn 0.3s ease-in-out reverse';
            
            setTimeout(() => {
                item.remove();
                updateAlternativeLetters();
                alternativeCount = alternativesContainer.querySelectorAll('.alternative-item').length;
            }, 300);
        }

        // Atualizar letras das alternativas após remoção
        function updateAlternativeLetters() {
            const items = alternativesContainer.querySelectorAll('.alternative-item');
            items.forEach((item, index) => {
                const letter = String.fromCharCode(65 + index); // A, B, C...
                item.querySelector('.alternative-letter').textContent = letter;
                item.querySelector('.alternative-input').placeholder = `Alternativa ${letter}`;
            });
        }

        // Adicionar questão
        questionForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const number = document.getElementById('questionNumber').value;
            const textContent = textEditor.innerHTML;
            const questionContent = questionEditor.innerHTML;
            
            // Verificar se o número da questão foi preenchido
            if (!number || number < 1) {
                alert('Digite um número válido para a questão.');
                document.getElementById('questionNumber').focus();
                return;
            }
            
            // Verificar se a questão não está vazia
            if (questionContent.trim() === '' || questionContent.includes('Digite a pergunta da questão...')) {
                alert('Digite a pergunta da questão.');
                questionEditor.focus();
                return;
            }
            
            // Coletar alternativas (apenas as preenchidas)
            const alternatives = [];
            const alternativeInputs = alternativesContainer.querySelectorAll('.alternative-input');
            
            alternativeInputs.forEach(input => {
                if (input.value.trim() !== '') {
                    alternatives.push(input.value.trim());
                }
            });
            
            // Criar objeto da questão
            const question = {
                id: Date.now(),
                number: parseInt(number),
                text: textContent.includes('Digite o texto de contexto') ? '' : textContent,
                question: questionContent,
                alternatives: alternatives
            };
            
            // Adicionar ao array
            questions.push(question);
            
            // Ordenar questões por número
            questions.sort((a, b) => a.number - b.number);
            
            // Atualizar interface
            renderQuestions();
            
            // Limpar formulário
            questionForm.reset();
            setupEditor(textEditor, 'Digite o texto de contexto (opcional)...');
            setupEditor(questionEditor, 'Digite a pergunta da questão...');
            
            // Resetar alternativas para 5 (A-E)
            alternativesContainer.innerHTML = `
                <div class="alternative-item">
                    <div class="alternative-letter">A</div>
                    <input type="text" class="form-control alternative-input" placeholder="Alternativa A">
                    <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="alternative-item">
                    <div class="alternative-letter">B</div>
                    <input type="text" class="form-control alternative-input" placeholder="Alternativa B">
                    <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="alternative-item">
                    <div class="alternative-letter">C</div>
                    <input type="text" class="form-control alternative-input" placeholder="Alternativa C">
                    <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="alternative-item">
                    <div class="alternative-letter">D</div>
                    <input type="text" class="form-control alternative-input" placeholder="Alternativa D">
                    <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="alternative-item">
                    <div class="alternative-letter">E</div>
                    <input type="text" class="form-control alternative-input" placeholder="Alternativa E">
                    <button type="button" class="btn btn-danger btn-sm btn-remove" onclick="removeAlternative(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            alternativeCount = 5;
            
            // Focar no próximo número
            document.getElementById('questionNumber').value = questions.length > 0 ? 
                Math.max(...questions.map(q => q.number)) + 1 : 1;
        });

        // Renderizar lista de questões
        function renderQuestions() {
            if (questions.length === 0) {
                questionsList.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-list"></i>
                        <p>Nenhuma questão adicionada ainda</p>
                    </div>
                `;
                return;
            }
            
            questionsList.innerHTML = questions.map(question => `
                <div class="question-item">
                    <div class="question-header">
                        <div class="question-number">Questão ${question.number}</div>
                        <button class="btn btn-danger btn-sm" onclick="removeQuestion(${question.id})">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                    <div class="question-content">
                        ${question.text ? `
                            <div class="text-section">
                                <div class="text-section-title">
                                    <i class="fas fa-align-left"></i> Texto
                                </div>
                                <div>${question.text}</div>
                            </div>
                        ` : ''}
                        <div class="question-section">
                            <div class="question-section-title">
                                <i class="fas fa-question-circle"></i> Questão
                            </div>
                            <div>${question.question}</div>
                        </div>
                    </div>
                    ${question.alternatives.length > 0 ? `
                        <ul class="alternatives-list">
                            ${question.alternatives.map((alt, index) => `
                                <li><strong>${String.fromCharCode(65 + index)}.</strong> ${alt}</li>
                            `).join('')}
                        </ul>
                    ` : ''}
                </div>
            `).join('');
        }

        // Remover questão
        function removeQuestion(id) {
            if (confirm('Tem certeza que deseja remover esta questão?')) {
                questions = questions.filter(q => q.id !== id);
                renderQuestions();
            }
        }

        // Exportar para .docx
        exportBtn.addEventListener('click', async function() {
            if (questions.length === 0) {
                alert('Adicione pelo menos uma questão antes de exportar.');
                return;
            }
            
            // Mostrar loading
            loadingIcon.style.display = 'inline-block';
            errorMessage.style.display = 'none';
            exportBtn.disabled = true;
            
            try {
                // Importar as bibliotecas necessárias
                const { Document, Packer, Paragraph, TextRun, HeadingLevel, AlignmentType, SectionType } = docx;
                
                // Criar array de parágrafos para o documento
                const docChildren = [];
                
                // Adicionar título
                docChildren.push(
                    new Paragraph({
                        text: "PROVA",
                        heading: HeadingLevel.HEADING_1,
                        alignment: AlignmentType.CENTER,
                        spacing: { after: 400 },
                    })
                );
                
                // Adicionar cada questão
                questions.forEach(question => {
                    // Número da questão
                    docChildren.push(
                        new Paragraph({
                            children: [
                                new TextRun({
                                    text: `Questão ${question.number}`,
                                    bold: true,
                                    size: 22, // 11pt
                                }),
                            ],
                            spacing: { before: 300, after: 200 },
                        })
                    );
                    
                    // Texto (se existir)
                    if (question.text && question.text.trim() !== '') {
                        const tempDiv = document.createElement('div');
                        tempDiv.innerHTML = question.text;
                        const plainText = tempDiv.textContent || tempDiv.innerText || '';
                        
                        docChildren.push(
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: "Texto:",
                                        bold: true,
                                        size: 22,
                                    }),
                                ],
                                spacing: { after: 100 },
                            })
                        );
                        
                        docChildren.push(
                            new Paragraph({
                                children: [
                                    new TextRun({
                                        text: plainText,
                                        size: 22,
                                    }),
                                ],
                                spacing: { after: 200 },
                            })
                        );
                    }
                    
                    // Questão
                    const tempDiv2 = document.createElement('div');
                    tempDiv2.innerHTML = question.question;
                    const questionText = tempDiv2.textContent || tempDiv2.innerText || '';
                    
                    docChildren.push(
                        new Paragraph({
                            children: [
                                new TextRun({
                                    text: "Questão:",
                                    bold: true,
                                    size: 22,
                                }),
                            ],
                            spacing: { after: 100 },
                        })
                    );
                    
                    docChildren.push(
                        new Paragraph({
                            children: [
                                new TextRun({
                                    text: questionText,
                                    size: 22,
                                }),
                            ],
                            spacing: { after: 200 },
                        })
                    );
                    
                    // Alternativas (se existirem)
                    if (question.alternatives.length > 0) {
                        question.alternatives.forEach((alt, index) => {
                            docChildren.push(
                                new Paragraph({
                                    children: [
                                        new TextRun({
                                            text: `${String.fromCharCode(65 + index)}) ${alt}`,
                                            size: 22,
                                        }),
                                    ],
                                    spacing: { after: 100 },
                                })
                            );
                        });
                    }
                    
                    // Espaçamento entre questões
                    docChildren.push(
                        new Paragraph({
                            children: [new TextRun("")],
                            spacing: { after: 300 },
                        })
                    );
                });
                
                // Criar documento
                const doc = new Document({
                    sections: [{
                        properties: {
                            page: {
                                margin: {
                                    top: 1701,    // 3cm em twips
                                    right: 1134,  // 2cm em twips
                                    bottom: 1134, // 2cm em twips
                                    left: 1701,   // 3cm em twips
                                },
                            },
                        },
                        children: docChildren,
                    }],
                    defaultStyles: {
                        paragraph: {
                            font: {
                                name: "Arial",
                                size: 22, // 11pt
                            },
                        },
                    },
                });
                
                // Gerar e baixar arquivo
                const blob = await Packer.toBlob(doc);
                saveAs(blob, "prova.docx");
                
                // Feedback visual
                const originalText = exportBtn.innerHTML;
                exportBtn.innerHTML = '<i class="fas fa-check"></i> Prova gerada com sucesso!';
                
                setTimeout(() => {
                    exportBtn.innerHTML = originalText;
                    exportBtn.disabled = false;
                    loadingIcon.style.display = 'none';
                }, 2000);
                
            } catch (error) {
                console.error('Erro ao gerar documento:', error);
                errorMessage.style.display = 'block';
                exportBtn.disabled = false;
                loadingIcon.style.display = 'none';
            }
        });

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const modal = document.getElementById('equationModal');
            if (event.target === modal) {
                closeEquationModal();
            }
        }

        // Inicializar
        document.getElementById('questionNumber').value = 1;
    </script>
</body>
</html>
